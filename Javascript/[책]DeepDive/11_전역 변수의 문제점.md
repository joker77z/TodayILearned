## 변수의 생명주기

모든 변수는 생명주기가 있다. 생명 주기가 없으면 한번 선언된 변수는 프로그램을 종료하지 않는 이상 메모리를 계속 점유한다. 변수는 자신이 선언된 위치에서 생성되고 소멸한다. 전역 변수는 애플리케이션 생명주기와 같다.

앞에서 변수 선언은 런타임 이전에 먼저 평가된다고 했다. 하지만, 이건 전역 변수에 한정된 것이다. 함수에서 변수의 생명주기를 알아보자.

```js
function foo() {
  let x = 'local';
  return x;
}

foo();
```

foo함수가 실행되면 그 때 x변수는 undefined로 초기화된다. 그리고 문들이 하나씩 실행되면 값이 할당된다. 지역 변수가 함수 생명과 대부분 일치하지만, 더 오래 생존하는 경우도 있다. (클로저)

> 변수의 생명 주기는 메모리 공간이 확보 - 해제되서 가용 메모리 풀에 반환되는 시점까지다. 할당된 메모리 공간은 더 이상 참조하지 않을 때 가비지 콜렉터에 의해 해제 되서 가용 메모리 풀에 반환된다. 즉, 누군가가 참고하고 있으면 공간을 확보한 상태로 남아있다.

<br />

### 전역 변수 var의 생명주기

var는 전역 변수로 선언 시 클라이언트 사이드 환경(브라우저)에서는 전역 객체인 window의 프로퍼티가 된다. 서버 사이드 환경(node.js)에서는 global 객체의 프로퍼티가 된다. 

> 참고로, 환경에 따라 전역객체를 가리키는 식별자(window, self, this, frames, global)가 존재했으나, ES11부터 globalThis로 통일되었다.

<br />

## 전역 변수의 문제점

- 긴 생명 주기 : 메모리 리소스도 오랜 기간 소비한다.
- 스코프 체인 상 종점 존재 : 즉, 가장 마지막에 검색되서 속도가 느리다.
- 네임스페이스 오염 : 모듈화가 되어있지 않은 js파일들은 전역 변수를 공유한다. 파일은 달라도 불러올 수 있다.

<br />

## 전역 변수 사용을 억제 하는 방법

전역 변수는 사용해야 할 이유를 찾지 못한다면 지역 변수를 사용하면 된다. 사용하지 말라는 것이 아니라 좁으면 좁을수록 좋다.

<br />

### 즉시 실행 함수

즉시 실행 함수는 단 한 번만 호출된다. 모든 코드를 즉시실행함수로 감싸면 모든 변수는 즉시 실행 함수의 지역 변수가 된다.

```js
(function () {
  var foo = 10; // 즉시 실행 함수의 지역 변수
})

console.log(foo) // undefined
```

> 이 방법으로 전역 변수가 생성되지 않기 때문에, 라이브러리 등에서 자주 사용한다.

<br />

### 네임 스페이스 객체

전역에 네임 스페이스가 되어줄 객체를 만들고 변수들을 프로퍼티처럼 추가한다.

```js
var MYAPP = {};

// solution1
MYAPP.name = 'Lee';
console.log(MYAPP.name); // Lee

// solution2
MYAPP.person = {
  name: 'Lee',
  address: 'Seoul'
}
```

> 하지만, 네임 스페이스로 객체를 만드는 것은 전역 변수에 할당되기 때문에 그다지 유용하지 않다.

<br />

### 모듈 패턴

클로저를 기반으로 동작한다. 전역 변수의 억제와 캡슐화까지 구현가능하다.

> 캡슐화는 객체의 상태가 되는 프로퍼티와 프로퍼티를 참조해 동작하는 메서드를 묶는 것을 말한다. 캡슐화를 통해 프로퍼티나 메서드를 감추기도 하는데 이를 정보 은닉이라 한다.

객체 지향 언어들에서는 public, private, protected 등 접근 제한자로 공개 범위를 한정할 수 있지만, js는 없기 때문에 클로저를 사용해서 구현한다. (ES2019부터 class에서 #이 추가되면서 private한 필드를 만들 수 있다.)

```js
const Counter = (() => {
  let number = 0;

  return {
    increase() {
      console.log(++number);
    },
    decrease() {
      console.log(--number);
      }
    }
})();

Counter.number // undefined;
Counter.increase(); // 1
Counter.decrease(); // 0
```

<br />

### ES6 모듈

**ES6모듈을 사용하면, 더는 전역 변수를 사용할 수 없다.** ES6 모듈은 파일 자체 독자적인 모듈 스코프를 제공한다.

```html
<script type="module" src="a.mjs"></script>
```

> ES6 모듈 기능을 사용하더라도 트랜스파일링이나 번들링이 필요하기 때문에 아직까지는 브라우저가 지원하는 ES6 모듈 기능보다는 Webpack 등의 모듈 번들러를 사용하는 것이 일반적이다.











