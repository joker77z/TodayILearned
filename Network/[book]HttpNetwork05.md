# 5장 : HTTP와 연계하는 웹 서버

> 웹 서버는 1대의 서버에서 멀티 도메인으로 웹사이트를 실행하거나, 중계 서버를 두어 통신 중 효율을 올릴 수 있다.

## 1대로 멀티 도메인을 가능하게 하는 가상 호스트

HTTP1.1에서는 하나의 HTTP서버에 여러 개 웹사이트를 실행할 수 있다. 예로 웹 호스팅을 제공하고 있는 사업자는 1대의 서버에 여러 개 웹 사이트를 넣을 수 있다. 이를 위해 **가상 호스트**가 사용된다. 물리적으로는 1대지만 가상으로 여러 대가 있는 것처럼 설정한다.

유저가 웹 사이트에 접속할 때 도메인명은 DNS에 의해 IP주소로 변환되고 결국, 리퀘스트도 서버에 도착한 시점에는 IP주소를 기준으로 액세스 한다. 이 때 1대의 서버안에서 어느 쪽에 대한 액세스인지 알 수가 없다. 그래서 HTTP 리퀘스트를 보낼 때 완벽한 URI를 지정하거나, 반드시 Host 헤더 필드에 지정해야 한다.



## 통신을 중계하는 프로그램 : 프록시, 게이트웨이, 터널

Http는 클라이언트와 서버 이외에 프록시, 게이트웨이, 터널과 같은 중계프로그램과 연계하는 것도 가능하다.

### 프록시

때에 따라 클라이언트 역할, 서버 역할을 하는 중계 프로그램.

프록시 서버를 사용하는 이유는 캐시를 사용하거나 특정 URI에 액세스를 제한, 액세스 로그를 획득하는 목적으로 사용한다.

캐시를 하는지 메시지를 변경하는지에 따라 두 가지로 구분할 수 있다.

#### 캐싱 프록시

프록시로 리스폰스를 중계할 때 프록시 서버에 리소스 캐시를 보관해 둘 수 있다.

프록시에 다시 같은 리퀘스트가 왔을 때 캐시를 리스폰스로 되돌려 준다.

### 투명 프록시

리퀘스트, 리스폰스를 중계할 때 메시지를 변경하지 않는다면 **투명 프록시**,

메시지에 변경을 가한다면 **비투과 프록시**라고 한다.

### 게이트웨이

다른 서버를 중계하는 서버. 리퀘스트한 리소스를 보유하는 것처럼 요청을 수신한다. 경우에 따라 클라이언트는 게이트웨이가 수신한 것이라는 것을 모를 수도 있다.

게이트웨이를 사용해서 HTTP리퀘스트 후 다른 프로토콜을 실행할 수 있다. 프록시와 동작은 매우 흡사하다. 게이트웨이는 리퀘스트 다음에 있는 서버가 HTTP서버 이외 서비스를 제공하는 서버가 된다. 클라이언트와 게이트웨이 사이를 암호화하여 안전성을 높이는 역할을 하거나, **데이터베이스에 접속해 쿼리를 사용하여 데이터를 얻는 곳**에 이용할 수도 있다. 혹은 **결제 시스템** 등과 연계할 때 사용되기도 한다.

### 터널

접속을 주선한다. 터널을 사용하여 안전하게 서버와 통신할 수 있다. SSL같은 암호화 통신을 위해 사용한다. HTTP 리퀘스트를 해석하려고 하지 않는다.

<br />

## 캐시

프록시에서 보관하는 캐시는 앞에서 설명한 바와 같다.

클라이언트에서 보관하는 캐시도 있는데, 인터넷 임시 파일이라고 부른다. 브라우저에서 유효한 파일을 가지고 있는 경우 서버로 요청하지 않고 로컬디스크에서 받아온다. 캐시 서버와 마찬가지로 오래됬다고 판단하면 오리진 서버에 유효성을 확인하거나, 다시 리소스를 획득하러 간다.

> 캐시는 유효기간이 있어서 오리진 서버에 리소스 유효성을 확인하거나 다시 리소스를 획득하러 가게 되는 경우가 있다. 이 부분에 대해서는 Cache-Control을 찾아볼 수 있다. 이 부분에 대해서는 [토스 기술 블로그](https://toss.tech/article/smart-web-service-cache)를 참고할 수 있었다.

